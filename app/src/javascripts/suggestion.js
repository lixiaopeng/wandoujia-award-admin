(function(a){a.fn.extend({suggestion:function(b){var c,d=a.extend({source:"http://suggest2.wandoujia.com/search_sug",formator:"",container:a("body"),form:".search-form",inputActivdClass:"actived-ipt"},b),e='<li><span class="word">{key}</span></li>',f=a('<div class="suggestion-wp"></div>').css({position:"absolute"}),g=a(".category-search"),h=g.width()+8,i=0,j=0,k=0,l="",m="";return currentIndex=-1,forceVisiable=0,fetchProcressing=0,isIE6=false,Prepare=function(b){var n=function(){d.container.append(f),f.html('<ul class="suggestion-list"></ul>'),c=f.find(".suggestion-list"),c.delegate("li","hover",function(){forceVisiable=1,c.children().removeClass("current"),a(this).addClass("current")}).delegate("li","mousedown",function(){l.val(a(this).text()),targetForm=l.closest(d.form),targetForm.submit()}).delegate("li","click",function(){l.val(a(this).text()),targetForm=l.closest(d.form),targetForm.submit()}).mouseout(function(){forceVisiable=0})},o=function(a){var b=c.children().length-1;if(-1!=b){a?(currentIndex+=1,currentIndex=currentIndex>b?0:currentIndex):(currentIndex-=1,currentIndex=0>currentIndex?b:currentIndex),c.children().removeClass("current");var d=c.children(":eq("+currentIndex+")");d.addClass("current"),l.val(d.text())}},p=function(){k||(g.length?f.width(b.outerWidth()-parseInt(f.css("border-left-width"))-parseInt(f.css("border-right-width"))-h):f.width(b.outerWidth()-parseInt(f.css("border-left-width"))-parseInt(f.css("border-right-width"))),k=1)},q=function(){!j&&l&&(f.css({top:l.offset().top+l.outerHeight()-parseInt(l.css("border-bottom-width")),left:l.offset().left}),j=1)},r=function(){forceVisiable||(c.empty(),f.hide(),m="",currentIndex=-1)},s=function(a){if(a.length){var b="";for(var d in a)b+=e.replace(/{key}/,a[d]);c.html(b)}f.show(),currentIndex=-1},t=function(a){return fetchProcressing=0,"undefined"!=typeof a&&a&&a.at&&!i?(s(a.wl),p(),q(),void 0):(r(),void 0)},u=function(){key=a.trim(b.val()),m==key||fetchProcressing||(key?(fetchProcressing=1,a.getScript(d.source+"?key="+key+"&cb=handleSugData"),m=key):r())},v=function(a){switch(a.keyCode){case 13:if(-1==currentIndex)return;i=1,targetForm=l.closest(d.form),l.val(c.children(".current").text()),r(),targetForm.submit();break;case 38:o(0);break;case 40:o(1)}};return window.handleSugData=t,{liveEvents:function(){b.bind({keydown:function(a){b.addClass(d.inputActivdClass),l=b,38!=a.keyCode&&40!=a.keyCode&&u(),isIE6||v(a)},keyup:function(a){38!=a.keyCode&&40!=a.keyCode&&u(),isIE6&&v(a)},focus:function(){b.addClass(d.inputActivdClass),l=b,u(),i=0},blur:function(){b.removeClass(d.inputActivdClass),r(),i=1,j=0}}),a(window).resize(function(){j=0,k=0,p(),q(),c.children().length||r()})},prepareDom:function(){n()}}},this.each(function(){var b=a(this),c=new Prepare(b);c.prepareDom(),c.liveEvents()})}})})(jQuery)
